import com.codeborne.selenide.Configuration;

import java.io.*;
import java.util.Properties;

import static com.codeborne.selenide.Selenide.$;

/**
 * Created by paulbaker on 2/17/17.
 */
public class Main {

    public static void main(String[] args) {
        Configuration.browser = "chrome";
//        Configuration.remote = "http://localhost:4444/wd/hub/";

        String data = "eyJEUFNNdWx0aXBsaWVyIjoiMy41MzAwMDAwMDAwMDAwMDAyIiwiRVBTIjoiMCIsIkVQUzIiOiI2ODEwIiwiRVBTTXVsdGlwbGllciI6IjUuMSIsImFjaGlldmUwMDFnb3QiOiIxIiwiYWNoaWV2ZTAwMmdvdCI6IjEiLCJhY2hpZXZlMDAzZ290IjoiMSIsImFjaGlldmUwMDRnb3QiOiIxIiwiYWNoaWV2ZTAwNWdvdCI6IjEiLCJhY2hpZXZlMDA2Z290IjoiMSIsImFjaGlldmUwMDdnb3QiOiIxIiwiYWNoaWV2ZTAwOGdvdCI6IjEiLCJhY2hpZXZlMDA5Z290IjoiMSIsImFjaGlldmUwMTBnb3QiOiIxIiwiYWNoaWV2ZTAxMWdvdCI6IjEiLCJhY2hpZXZlMDEyZ290IjoiMSIsImFjaGlldmUwMTNnb3QiOiIxIiwiYWNoaWV2ZTAxNGdvdCI6IjEiLCJhY2hpZXZlMDE1Z290IjoiMSIsImFjaGlldmUwMTZnb3QiOiIxIiwiYWNoaWV2ZTAxN2dvdCI6IjAiLCJhY2hpZXZlMDE4Z290IjoiMCIsImFjaGlldmUwMTlnb3QiOiIxIiwiYWNoaWV2ZTAyMGdvdCI6IjEiLCJhY2hpZXZlMDIxZ290IjoiMSIsImFjaGlldmUwMjJnb3QiOiIxIiwiYWNoaWV2ZTAyM2dvdCI6IjAiLCJhY2hpZXZlMDI0Z290IjoiMCIsImFjaGlldmUwMjVnb3QiOiIxIiwiYWNoaWV2ZTAyNmdvdCI6IjEiLCJhY2hpZXZlMDI3Z290IjoiMSIsImFjaGlldmUwMjhnb3QiOiIxIiwiYWNoaWV2ZTAyOWdvdCI6IjEiLCJhY2hpZXZlMDMwZ290IjoiMSIsImFjaGlldmUwMzFnb3QiOiIxIiwiYWNoaWV2ZTAzMmdvdCI6IjEiLCJhY2hpZXZlMDMzZ290IjoiMSIsImFjaGlldmUwMzRnb3QiOiIxIiwiYWNoaWV2ZTAzNWdvdCI6IjEiLCJhY2hpZXZlMDM2Z290IjoiMSIsImFjaGlldmUwMzdnb3QiOiIxIiwiYWNoaWV2ZTAzOGdvdCI6IjEiLCJhY2hpZXZlMDM5Z290IjoiMSIsImFjaGlldmUwNDBnb3QiOiIxIiwiYWNoaWV2ZTA0MWdvdCI6IjEiLCJhY2hpZXZlMDQyZ290IjoiMCIsImFjaGlldmUwNDNnb3QiOiIxIiwiYWNoaWV2ZTA0NGdvdCI6IjEiLCJhY2hpZXZlMDQ1Z290IjoiMSIsImFjaGlldmUwNDZnb3QiOiIxIiwiYWNoaWV2ZTA0N2dvdCI6IjEiLCJhY2hpZXZlMDQ4Z290IjoiMCIsImFjaGlldmUwNDlnb3QiOiIxIiwiYWNoaWV2ZTA1MGdvdCI6IjEiLCJhY2hpZXZlMDUxZ290IjoiMSIsImFjaGlldmUwNTJnb3QiOiIxIiwiYWNoaWV2ZTA1M2dvdCI6IjAiLCJhY2hpZXZlMDU0Z290IjoiMCIsImFjaGlldmUwNTVnb3QiOiIxIiwiYWNoaWV2ZTA1NmdvdCI6IjEiLCJhY2hpZXZlMDU3Z290IjoiMSIsImFjaGlldmUwNThnb3QiOiIwIiwiYWNoaWV2ZTA1OWdvdCI6IjAiLCJhY2hpZXZlMDYwZ290IjoiMCIsImFjaGlldmUwNjFnb3QiOiIxIiwiYWNoaWV2ZTA2MmdvdCI6IjEiLCJhY2hpZXZlMDYzZ290IjoiMCIsImFjaGlldmUwNjRnb3QiOiIwIiwiYWNoaWV2ZTA2NWdvdCI6IjAiLCJhY2hpZXZlMDY2Z290IjoiMCIsImFjaGlldmUwNjdnb3QiOiIxIiwiYWNoaWV2ZTA2OGdvdCI6IjEiLCJhY2hpZXZlMDY5Z290IjoiMSIsImFjaGlldmUwNzBnb3QiOiIxIiwiYWNoaWV2ZTA3MWdvdCI6IjEiLCJhY2hpZXZlMDcyZ290IjoiMCIsImFjaGlldmUwNzNnb3QiOiIwIiwiYWNoaWV2ZTA3NGdvdCI6IjAiLCJhY2hpZXZlMDc1Z290IjoiMCIsImFjaGlldmUwNzZnb3QiOiIwIiwiYWlyY3JhZnRVbmxvY2tlZCI6IjEiLCJhcm15MDAxVW5sb2NrZWQiOiIxIiwiYXJteTAwMlVubG9ja2VkIjoiMSIsImFybXkwMDNVbmxvY2tlZCI6IjEiLCJhcm15MDA0VW5sb2NrZWQiOiIxIiwiYXJteTAwNVVubG9ja2VkIjoiMSIsImFybXkwMDZVbmxvY2tlZCI6IjAiLCJhcm15MDA3VW5sb2NrZWQiOiIwIiwiYXJteTAwOFVubG9ja2VkIjoiMCIsImFybXkwMDlVbmxvY2tlZCI6IjAiLCJhcm15MDEwVW5sb2NrZWQiOiIwIiwiYmFycmFja3NVbmxvY2tlZCI6IjEiLCJib3VnaHRBaXJjcmFmdF8wN19hIjoiMSIsImJvdWdodEJhcnJhY2tzXzAyX2EiOiIxIiwiYm91Z2h0QmFycmFja3NfMDJfYiI6IjEiLCJib3VnaHRCYXJyYWNrc18wM19hIjoiMSIsImJvdWdodEJhcnJhY2tzXzAzX2IiOiIxIiwiYm91Z2h0QmFycmFja3NfMDNfYyI6IjEiLCJib3VnaHRCYXJyYWNrc18wNF9hIjoiMSIsImJvdWdodEJhcnJhY2tzXzA0X2IiOiIxIiwiYm91Z2h0QmFycmFja3NfMDRfYyI6IjEiLCJib3VnaHRCYXJyYWNrc18wNF9kIjoiMSIsImJvdWdodEJhcnJhY2tzXzA1X2EiOiIxIiwiYm91Z2h0QmFycmFja3NfMDVfYiI6IjEiLCJib3VnaHRCYXJyYWNrc18wNV9jIjoiMSIsImJvdWdodEJhcnJhY2tzXzA1X2QiOiIxIiwiYm91Z2h0QmFycmFja3NfMDZfYSI6IjEiLCJib3VnaHRCYXJyYWNrc18wNl9iIjoiMSIsImJvdWdodEJhcnJhY2tzXzA3X2EiOiIxIiwiYm91Z2h0QmFycmFja3NfMDdfYiI6IjEiLCJib3VnaHRCYXJyYWNrc18wN19jIjoiMSIsImJvdWdodE1vbm9saXRoXzAxX2EiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDFfYiI6IjEiLCJib3VnaHRNb25vbGl0aF8wMV9jIjoiMSIsImJvdWdodE1vbm9saXRoXzAxX2QiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDJfYSI6IjEiLCJib3VnaHRNb25vbGl0aF8wMl9iIjoiMSIsImJvdWdodE1vbm9saXRoXzAyX2MiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDNfYSI6IjEiLCJib3VnaHRNb25vbGl0aF8wM19iIjoiMSIsImJvdWdodE1vbm9saXRoXzAzX2MiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDNfZCI6IjEiLCJib3VnaHRNb25vbGl0aF8wM19lIjoiMSIsImJvdWdodE1vbm9saXRoXzA0X2EiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDRfYiI6IjEiLCJib3VnaHRNb25vbGl0aF8wNF9jIjoiMSIsImJvdWdodE1vbm9saXRoXzA0X2QiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDVfYSI6IjEiLCJib3VnaHRNb25vbGl0aF8wNV9iIjoiMSIsImJvdWdodE1vbm9saXRoXzA1X2MiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDVfZCI6IjEiLCJib3VnaHRNb25vbGl0aF8wNV9lIjoiMSIsImJvdWdodE1vbm9saXRoXzA2X2EiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDZfYiI6IjEiLCJib3VnaHRNb25vbGl0aF8wNl9jIjoiMSIsImJvdWdodE1vbm9saXRoXzA2X2QiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDZfZSI6IjEiLCJib3VnaHRNb25vbGl0aF8wN19hIjoiMSIsImJvdWdodE1vbm9saXRoXzA3X2IiOiIxIiwiYm91Z2h0TW9ub2xpdGhfMDdfYyI6IjEiLCJib3VnaHRNb25vbGl0aF8wN19kIjoiMSIsImJvdWdodE1vbm9saXRoXzA3X2UiOiIwIiwiYm91Z2h0U2llZ2VfMDRfYSI6IjEiLCJib3VnaHRTaWVnZV8wNV9hIjoiMSIsImJvdWdodFNpZWdlXzA2X2EiOiIxIiwiYm91Z2h0U2llZ2VfMDZfYiI6IjEiLCJib3VnaHRTaWVnZV8wN19hIjoiMSIsImJvdWdodFNpZWdlXzA3X2IiOiIxIiwiYm91Z2h0U3dvcmRfMDFfYSI6IjEiLCJib3VnaHRTd29yZF8wMl9hIjoiMSIsImJvdWdodFN3b3JkXzAyX2IiOiIxIiwiYm91Z2h0U3dvcmRfMDNfYSI6IjEiLCJib3VnaHRTd29yZF8wM19iIjoiMSIsImJvdWdodFN3b3JkXzA0X2EiOiIxIiwiYm91Z2h0U3dvcmRfMDRfYiI6IjEiLCJib3VnaHRTd29yZF8wNV9hIjoiMSIsImJvdWdodFN3b3JkXzA1X2IiOiIxIiwiYm91Z2h0U3dvcmRfMDZfYSI6IjEiLCJib3VnaHRTd29yZF8wNl9iIjoiMSIsImJvdWdodFN3b3JkXzA3X2EiOiIxIiwiYm91Z2h0U3dvcmRfMDdfYiI6IjEiLCJjb2xsaWRlclVubG9ja2VkIjoiMCIsImNvc3RBaXJjcmFmdCI6IjE3MDExMjQ0OSIsImNvc3RDaGFvcyI6IjAiLCJjb3N0TWVsZWUiOiI0OTY5MDc4NDciLCJjb3N0TWlzc2lsZSI6IjAiLCJjb3N0TW91bnRlZCI6IjIwODAxNjc5MDc1IiwiY29zdFJhbmdlZCI6IjQxNDA4OTg3MjYiLCJjb3N0U2F0ZWxsaXRlIjoiMCIsImNvc3RTY2hvbGFyIjoiODI4MTc5NzQ1MiIsImNvc3RTaWVnZSI6IjM2MzQyNTk5NjgiLCJjb3N0U3BhY2VzaGlwIjoiMCIsImNvc3RXaWxsIjoiMCIsImN1cnJlbnRBZ2UiOiI3IiwiZGFtYWdlIjoiODA4NTAwNDQzMjE5LjU4MTQiLCJkYW1hZ2VUb0V2byI6IjQiLCJldm9Qb2ludHMiOiIyOTQwMDc2NjYwMS4yODQ3MzciLCJtaXNzaWxlVW5sb2NrZWQiOiIwIiwibW9ub2xpdGhVbmxvY2tlZCI6IjEiLCJuYW1lQWlyY3JhZnQiOiI3IiwibmFtZUNoYW9zIjoiMSIsIm5hbWVNZWxlZSI6IjciLCJuYW1lTWlzc2lsZSI6IjEiLCJuYW1lTW91bnRlZCI6IjciLCJuYW1lUmFuZ2VkIjoiNyIsIm5hbWVTYXRlbGxpdGUiOiIxIiwibmFtZVNjaG9sYXIiOiI3IiwibmFtZVNpZWdlIjoiNyIsIm5hbWVTcGFjZXNoaXAiOiIxIiwibmFtZVdpbGwiOiIxIiwib3duZWRBaXJjcmFmdCI6IjM3Iiwib3duZWRDaGFvcyI6IjAiLCJvd25lZE1lbGVlIjoiMTAxIiwib3duZWRNaXNzaWxlIjoiMCIsIm93bmVkTW91bnRlZCI6Ijk0Iiwib3duZWRSYW5nZWQiOiIxMDAiLCJvd25lZFNhdGVsbGl0ZSI6IjAiLCJvd25lZFNjaG9sYXIiOiIxMDAiLCJvd25lZFNpZWdlIjoiNjgiLCJvd25lZFNwYWNlc2hpcCI6IjAiLCJvd25lZFdpbGwiOiIwIiwicG93ZXJBaXJjcmFmdCI6IjI1MDAwIiwicG93ZXJDaGFvcyI6IjEiLCJwb3dlck1lbGVlIjoiMTkyIiwicG93ZXJNaXNzaWxlIjoiMSIsInBvd2VyTW91bnRlZCI6IjE4MDAiLCJwb3dlclJhbmdlZCI6IjU3NiIsInBvd2VyU2F0ZWxsaXRlIjoiMSIsInBvd2VyU2Nob2xhciI6IjQzMyIsInBvd2VyU2llZ2UiOiIyODAwMCIsInBvd2VyU3BhY2VzaGlwIjoiMSIsInBvd2VyV2lsbCI6IjEiLCJzYXZlZCI6IjEiLCJzaWVnZVVubG9ja2VkIjoiMSIsInNwYWNlZmFjdG9yeVVubG9ja2VkIjoiMCIsInN0YXRCcmVha3Rocm91Z2giOiI0Iiwic3RhdENyaXRzIjoiOSIsInN0YXREbWdBbGxUaW1lIjoiODA4NTAwNDQzMjE5LjU4MTQiLCJzdGF0RG1nU3dvcmQiOiI5NDU4MjQ4MiIsInN0YXRFdm9BbGxUaW1lIjoiMjE3NTc4NzYyMTkwLjI4NzY2Iiwic3RhdEV2b0dhbWUiOiIyMTc1Nzg3NjIxOTAuMjg3NjYiLCJzdGF0U2hhcmRzIjoiMCIsInN0YXRTd29yZFN3aW5ncyI6IjI1MTgiLCJzdGF0V2FyY3J5IjoiMyIsInN3b3JkUG93ZXIiOiI1NzExMiIsInVubG9ja2VkQWlyY3JhZnRfMDdfYSI6IjAiLCJ1bmxvY2tlZEJhcnJhY2tzXzAyX2EiOiIwIiwidW5sb2NrZWRCYXJyYWNrc18wMl9iIjoiMCIsInVubG9ja2VkQmFycmFja3NfMDNfYSI6IjAiLCJ1bmxvY2tlZEJhcnJhY2tzXzAzX2IiOiIwIiwidW5sb2NrZWRCYXJyYWNrc18wM19jIjoiMCIsInVubG9ja2VkQmFycmFja3NfMDRfYSI6IjAiLCJ1bmxvY2tlZEJhcnJhY2tzXzA0X2IiOiIwIiwidW5sb2NrZWRCYXJyYWNrc18wNF9jIjoiMCIsInVubG9ja2VkQmFycmFja3NfMDRfZCI6IjAiLCJ1bmxvY2tlZEJhcnJhY2tzXzA1X2EiOiIwIiwidW5sb2NrZWRCYXJyYWNrc18wNV9iIjoiMCIsInVubG9ja2VkQmFycmFja3NfMDVfYyI6IjAiLCJ1bmxvY2tlZEJhcnJhY2tzXzA1X2QiOiIwIiwidW5sb2NrZWRCYXJyYWNrc18wNl9hIjoiMCIsInVubG9ja2VkQmFycmFja3NfMDZfYiI6IjAiLCJ1bmxvY2tlZEJhcnJhY2tzXzA3X2EiOiIwIiwidW5sb2NrZWRCYXJyYWNrc18wN19iIjoiMCIsInVubG9ja2VkQmFycmFja3NfMDdfYyI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzAxX2EiOiIxIiwidW5sb2NrZWRNb25vbGl0aF8wMV9iIjoiMSIsInVubG9ja2VkTW9ub2xpdGhfMDFfYyI6IjEiLCJ1bmxvY2tlZE1vbm9saXRoXzAxX2QiOiIxIiwidW5sb2NrZWRNb25vbGl0aF8wMl9hIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDJfYiI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzAyX2MiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wM19hIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDNfYiI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzAzX2MiOiIxIiwidW5sb2NrZWRNb25vbGl0aF8wM19kIjoiMSIsInVubG9ja2VkTW9ub2xpdGhfMDNfZSI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzA0X2EiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wNF9iIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDRfYyI6IjEiLCJ1bmxvY2tlZE1vbm9saXRoXzA0X2QiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wNV9hIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDVfYiI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzA1X2MiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wNV9kIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDVfZSI6IjEiLCJ1bmxvY2tlZE1vbm9saXRoXzA2X2EiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wNl9iIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDZfYyI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzA2X2QiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wNl9lIjoiMSIsInVubG9ja2VkTW9ub2xpdGhfMDdfYSI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzA3X2IiOiIwIiwidW5sb2NrZWRNb25vbGl0aF8wN19jIjoiMCIsInVubG9ja2VkTW9ub2xpdGhfMDdfZCI6IjAiLCJ1bmxvY2tlZE1vbm9saXRoXzA3X2UiOiIwIiwidW5sb2NrZWRTaWVnZV8wNF9hIjoiMCIsInVubG9ja2VkU2llZ2VfMDVfYSI6IjAiLCJ1bmxvY2tlZFNpZWdlXzA2X2EiOiIwIiwidW5sb2NrZWRTaWVnZV8wNl9iIjoiMCIsInVubG9ja2VkU2llZ2VfMDdfYSI6IjAiLCJ1bmxvY2tlZFNpZWdlXzA3X2IiOiIwIiwidW5sb2NrZWRTd29yZF8wMV9hIjoiMCIsInVubG9ja2VkU3dvcmRfMDJfYSI6IjAiLCJ1bmxvY2tlZFN3b3JkXzAyX2IiOiIwIiwidW5sb2NrZWRTd29yZF8wM19hIjoiMCIsInVubG9ja2VkU3dvcmRfMDNfYiI6IjAiLCJ1bmxvY2tlZFN3b3JkXzA0X2EiOiIwIiwidW5sb2NrZWRTd29yZF8wNF9iIjoiMCIsInVubG9ja2VkU3dvcmRfMDVfYSI6IjAiLCJ1bmxvY2tlZFN3b3JkXzA1X2IiOiIwIiwidW5sb2NrZWRTd29yZF8wNl9hIjoiMCIsInVubG9ja2VkU3dvcmRfMDZfYiI6IjAiLCJ1bmxvY2tlZFN3b3JkXzA3X2EiOiIwIiwidW5sb2NrZWRTd29yZF8wN19iIjoiMCIsIndoaWNoU3dvcmQiOiI3In0=";

        try (InputStream inputStream = new FileInputStream(MonolithPage.DEFAULT_SAVEFILE)) {
            Properties properties = new Properties();
            properties.load(inputStream);
            data = properties.getProperty("data", data);
        } catch (IOException ignored) {
        }

        final String finalData = data;

        try (MonolithPage monolithPage = new MonolithPage(MonolithPage.DEFAULT_SAVEFILE).getStatsContainer(stats -> stats.importGame(finalData))) {

            LambdaTimer saveTimer = new LambdaTimer(1000 * 60 * 5, () -> monolithPage.getStatsContainer(statsContainer -> {
                String updatedData = statsContainer.saveGame().exportGame();
                try (OutputStream outputStream = new FileOutputStream(MonolithPage.DEFAULT_SAVEFILE)) {
                    Properties properties = new Properties();
                    properties.setProperty("data", updatedData);
                    properties.store(outputStream, null);
                } catch (IOException ignored) {
                    System.err.println(String.format("COULDN'T SAVE: %s", updatedData));
                }
            }));

            boolean playing = true;
            /*
            This is a terrible way to to this, but loop until we
            change the value of playing via the debugger.
             */
            while (playing) {
                monolithPage.attack();
                if ($("#critical").exists()) {
                    $("#critical").click();
                }
                saveTimer.runIfExpired();
            }
        }
    }
}
